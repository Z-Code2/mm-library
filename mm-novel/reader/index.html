<!DOCTYPE html>
<html lang="my">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reader - mm-novel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body.light { background: #f7fafc; color: #1a202c; }
    body.sepia { background: #f4ecd8; color: #3b2f1e; }
    body.dark  { background: #1a202c; color: #e2e8f0; }
    .reading-view p { margin-bottom: 1rem; text-align: justify; }
  </style>
</head>
<body class="light font-sans transition-colors duration-300">

  <header class="bg-white shadow p-4 flex justify-between items-center sticky top-0 z-10">
    <h1 class="text-2xl font-bold text-indigo-600 cursor-pointer" onclick="showHome()">üìö mm-novel</h1>
    <div class="flex space-x-3 items-center">
      <button onclick="adjustFont(-1)" class="bg-gray-200 px-3 py-1 rounded">Aa‚àí</button>
      <button onclick="adjustFont(1)" class="bg-gray-200 px-3 py-1 rounded">Aa+</button>
      <select id="themeSelect" onchange="changeTheme(this.value)" class="border rounded p-1 text-sm">
        <option value="light">‚òÄÔ∏è Light</option>
        <option value="sepia">üìú Sepia</option>
        <option value="dark">üåô Dark</option>
      </select>
      <a href="../admin/" class="text-sm text-indigo-600 underline">Admin</a>
    </div>
  </header>

  <main id="content" class="p-4"></main>

  <script>
  let books = [];
  let fontSize = parseInt(localStorage.getItem("fontSize") || 18);
  let theme = localStorage.getItem("theme") || "light";

  document.body.className = theme;
  document.getElementById("themeSelect").value = theme;
  document.documentElement.style.fontSize = fontSize + "px";

  async function loadBooks() {
    const res = await fetch("../books.json");
    books = await res.json();
    showHome();
  }

  function showHome() {
    const container = document.getElementById("content");
    container.innerHTML = `
      <h2 class="text-xl font-bold mb-3">·ÄÖ·Ä¨·Ä°·ÄØ·Äï·Ä∫·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏</h2>
      <div id="bookList" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
    `;
    const el = document.getElementById("bookList");
    el.innerHTML = books.map(book => `
      <div onclick="showBookDetail('${book.id}')" class="bg-white dark:bg-gray-800 p-4 rounded shadow hover:shadow-lg cursor-pointer">
        <div class="h-32 bg-gray-200 dark:bg-gray-700 flex items-center justify-center font-bold">${book.title}</div>
        <p class="text-sm text-gray-600 dark:text-gray-300 mt-2">${book.author}</p>
      </div>
    `).join('');
  }

  function showBookDetail(id) {
    const book = books.find(b => b.id === id);
    const container = document.getElementById("content");
    container.innerHTML = `
      <button onclick="showHome()" class="text-indigo-600 underline mb-2">‚Üê ·Äï·Äº·Äî·Ä∫·Äû·ÄΩ·Ä¨·Ä∏·Äô·Ää·Ä∫</button>
      <div class="bg-white dark:bg-gray-800 p-4 rounded shadow">
        <h2 class="text-2xl font-bold mb-3">${book.title}</h2>
        <p class="text-gray-500 dark:text-gray-300 mb-4">·ÄÖ·Ä¨·Äõ·Ä±·Ä∏·Äû·Ä∞: ${book.author}</p>
        ${book.chapters.map((ch, i) => `
          <div class="border-b p-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700" onclick="readChapter('${book.id}',${i})">
            ·Ä°·ÄÅ·Äî·Ä∫·Ä∏ ${i + 1}: ${ch.title}
          </div>
        `).join('')}
      </div>
    `;
  }

  function readChapter(bookId, index) {
    const book = books.find(b => b.id === bookId);
    const ch = book.chapters[index];
    const container = document.getElementById("content");
    container.innerHTML = `
      <button onclick="showBookDetail('${bookId}')" class="text-indigo-600 underline mb-3">‚Üê ${book.title}</button>
      <div class="bg-white dark:bg-gray-800 p-4 rounded shadow leading-relaxed reading-view">
        <h3 class="text-xl font-bold mb-2">${ch.title}</h3>
        <p>${ch.content.replace(/\n/g, '<br>')}</p>
      </div>
    `;
  }

  function adjustFont(change) {
    fontSize = Math.min(Math.max(fontSize + change, 12), 28);
    document.documentElement.style.fontSize = fontSize + "px";
    localStorage.setItem("fontSize", fontSize);
  }

  function changeTheme(t) {
    theme = t;
    document.body.className = theme;
    localStorage.setItem("theme", theme);
  }

  loadBooks();
  </script>
</body>
</html>